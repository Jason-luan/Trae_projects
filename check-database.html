<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>检查排班系统数据库</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h1>检查排班系统数据库</h1>
        <button id="checkShifts">检查班次数据</button>
        <h2>所有班次数据:</h2>
        <pre id="allShiftsData"></pre>
        <h2>启用的非休班次数据:</h2>
        <pre id="activeNonRestShiftsData"></pre>
        <h2>数据库统计:</h2>
        <pre id="dbStats"></pre>
    </div>
    
    <script>
        document.getElementById('checkShifts').addEventListener('click', function() {
            const request = indexedDB.open('scheduleSystemDB', 10);
            
            request.onerror = function(event) {
                console.error('无法打开数据库:', event.target.error);
                document.getElementById('allShiftsData').textContent = '无法打开数据库: ' + event.target.error;
            };
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                const transaction = db.transaction('shifts', 'readonly');
                const store = transaction.objectStore('shifts');
                const getAllRequest = store.getAll();
                
                getAllRequest.onsuccess = function() {
                    const shifts = getAllRequest.result;
                    
                    // 显示所有班次数据
                    document.getElementById('allShiftsData').textContent = JSON.stringify(shifts, null, 2);
                    
                    // 显示启用的非休班次数据
                    const activeNonRestShifts = shifts.filter(shift => shift.status === 0 && shift.code !== '休');
                    document.getElementById('activeNonRestShiftsData').textContent = JSON.stringify(activeNonRestShifts, null, 2);
                    
                    // 显示数据库统计信息
                    const stats = {
                        总班次数量: shifts.length,
                        启用的班次数量: shifts.filter(shift => shift.status === 0).length,
                        启用的非休班次数量: activeNonRestShifts.length,
                        休息班次数量: shifts.filter(shift => shift.code === '休').length,
                        启用的休息班次数量: shifts.filter(shift => shift.code === '休' && shift.status === 0).length
                    };
                    document.getElementById('dbStats').textContent = JSON.stringify(stats, null, 2);
                    
                    db.close();
                };
                
                getAllRequest.onerror = function(event) {
                    console.error('获取班次数据失败:', event.target.error);
                    document.getElementById('allShiftsData').textContent = '获取班次数据失败: ' + event.target.error;
                };
            };
        });
    </script>
</body>
</html>
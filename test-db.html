<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据库测试</title>
    <script src="js/indexed-db-manager.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        h1, h2 {
            color: #333;
        }
        button {
            padding: 8px 16px;
            margin-right: 10px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>IndexedDB 测试工具</h1>
        
        <h2>机构数据测试</h2>
        <button id="getOrgs">获取所有机构</button>
        <button id="addOrg">添加测试机构</button>
        <button id="clearOrgs">清空机构数据</button>
        <pre id="orgResult"></pre>
        
        <h2>员工数据测试</h2>
        <button id="getEmps">获取所有员工</button>
        <pre id="empResult"></pre>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化数据库管理器
            const dbManager = new IndexedDBManager();
            let initialized = false;

            // 初始化数据库
            dbManager.initDB()
                .then(() => {
                    console.log('数据库初始化成功');
                    initialized = true;
                })
                .catch(error => {
                    console.error('数据库初始化失败:', error);
                    document.getElementById('orgResult').textContent = '数据库初始化失败: ' + error.message;
                });

            // 获取所有机构
            document.getElementById('getOrgs').addEventListener('click', function() {
                if (!initialized) {
                    document.getElementById('orgResult').textContent = '数据库尚未初始化';
                    return;
                }

                dbManager.getAll('organizations')
                    .then(orgs => {
                        document.getElementById('orgResult').textContent = JSON.stringify(orgs, null, 2);
                    })
                    .catch(error => {
                        document.getElementById('orgResult').textContent = '获取机构失败: ' + error.message;
                    });
            });

            // 添加测试机构
            document.getElementById('addOrg').addEventListener('click', function() {
                if (!initialized) {
                    document.getElementById('orgResult').textContent = '数据库尚未初始化';
                    return;
                }

                const testOrg = {
                    code: 'TEST' + Math.floor(Math.random() * 10000),
                    name: '测试机构' + Math.floor(Math.random() * 100),
                    description: '这是一个测试机构',
                    remark: '测试数据',
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    status: 'active'
                };

                dbManager.save('organizations', testOrg)
                    .then(() => {
                        document.getElementById('orgResult').textContent = '添加机构成功: ' + JSON.stringify(testOrg, null, 2);
                    })
                    .catch(error => {
                        document.getElementById('orgResult').textContent = '添加机构失败: ' + error.message;
                    });
            });

            // 清空机构数据
            document.getElementById('clearOrgs').addEventListener('click', function() {
                if (!initialized) {
                    document.getElementById('orgResult').textContent = '数据库尚未初始化';
                    return;
                }

                if (confirm('确定要清空所有机构数据吗？')) {
                    dbManager.clearStore('organizations')
                        .then(() => {
                            document.getElementById('orgResult').textContent = '机构数据已清空';
                        })
                        .catch(error => {
                            document.getElementById('orgResult').textContent = '清空机构数据失败: ' + error.message;
                        });
                }
            });

            // 获取所有员工
            document.getElementById('getEmps').addEventListener('click', function() {
                if (!initialized) {
                    document.getElementById('empResult').textContent = '数据库尚未初始化';
                    return;
                }

                dbManager.getAll('employees')
                    .then(emps => {
                        document.getElementById('empResult').textContent = JSON.stringify(emps, null, 2);
                    })
                    .catch(error => {
                        document.getElementById('empResult').textContent = '获取员工失败: ' + error.message;
                    });
            });
        });
    </script>
</body>
</html>